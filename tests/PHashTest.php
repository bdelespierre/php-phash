<?php

namespace Tests;

use Bdelespierre\PhpPhash\PHash;
use Intervention\Image\ImageManager;
use PHPUnit\Framework\TestCase;

class PHashTest extends TestCase
{
    /**
     * @dataProvider hashDataProvider
     */
    public function testHash(string $file, int $size, string $hash)
    {
        $hasher = new PHash(new ImageManager(['driver' => 'imagick']));
        $file = new \SplFileInfo($file);

        $this->assertEquals(
            $hash,
            $hasher->hash($file, $size),
        );
    }

    public function hashDataProvider()
    {
        return [
            'red dress 1.1' => [
                'file' => __DIR__.'/images/NKIE-WD294_V1.jpg',
                'size' => 8,
                'hash' => '1111111111111111111011110000000000000001100011111111111111111111',
            ],
            'red dress 1.2' => [
                'file' => __DIR__.'/images/NKIE-WD294_V2.jpg',
                'size' => 16,
                'hash' => '1111111111111111111111111111111111111111111111111111111111111111111111111111111111100000111111111000000000000011000000000000000000000000000000001000000000000111111111111101111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
            ],
            'red dress 1.3' => [
                'file' => __DIR__.'/images/NKIE-WD294_V3.jpg',
                'size' => 32,
                'hash' => '1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000011111111111111111111110000000000000111111111111111111100000000000000001111111111110000000000000000000000000000101000000000000000000000000000000000000000000000000000000000011100000000000000000000000000101110000100110000000000000000000000000001111100000000000000000000001111111111000000000000000011111111111111110000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
            ],
            'red dress 2.1' => [
                'file' => __DIR__.'/images/SPDW-WD215_V1.jpg',
                'size' => 8,
                'hash' => '1111111111111111111011110000000000000000100011111111111111111111',
            ],
            'red dress 2.2' => [
                'file' => __DIR__.'/images/SPDW-WD215_V2.jpg',
                'size' => 16,
                'hash' => '1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100011000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
            ],
            'red dress 2.3' => [
                'file' => __DIR__.'/images/SPDW-WD215_V3.jpg',
                'size' => 32,
                'hash' => '1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000111111111111111111100000000000000000000011111110000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000001111100000000000000000000000001111111000000000000000000000000111111111000000000000111111111111111111111111111100111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
            ],
        ];
    }
}
